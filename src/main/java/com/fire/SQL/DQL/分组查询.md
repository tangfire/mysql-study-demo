在 SQL 中，`WHERE` 和 `HAVING` 都是用于筛选数据的子句，但它们在功能、使用场景和执行逻辑上有显著区别。以下是两者的核心差异及具体应用场景：

---

### **1. 执行时机与作用对象**
- **`WHERE` 子句**
    - **执行时机**：在数据分组（`GROUP BY`）**之前**过滤原始数据行。
    - **作用对象**：直接对表中的单行数据进行筛选。
    - **示例**：筛选年龄大于 30 岁的员工：
      ```sql
      SELECT * FROM employees WHERE age > 30;
      ```

- **`HAVING` 子句**
    - **执行时机**：在数据分组（`GROUP BY`）**之后**过滤聚合后的分组结果。
    - **作用对象**：对分组后的聚合结果（如 `SUM`、`AVG`）进行筛选。
    - **示例**：筛选总销量大于 100 的产品：
      ```sql
      SELECT product, SUM(quantity) 
      FROM sales 
      GROUP BY product 
      HAVING SUM(quantity) > 100;
      ```

---

### **2. 支持的操作类型**
- **`WHERE` 的限制**
    - **不能使用聚合函数**（如 `COUNT`、`SUM`），因为它处理的是未分组的数据。
    - **示例错误**：`SELECT dept_id FROM employees WHERE COUNT(*) > 5;` 会报错。

- **`HAVING` 的灵活性**
    - **支持聚合函数**：可直接在条件中引用聚合结果。
    - **示例**：筛选平均工资超过 5000 的部门：
      ```sql
      SELECT department, AVG(salary) 
      FROM employees 
      GROUP BY department 
      HAVING AVG(salary) > 5000;
      ```

---

### **3. 性能与优化建议**
- **`WHERE` 的性能优势**
    - **减少数据处理量**：在分组前过滤数据，降低后续计算的负载。
    - **适用场景**：若筛选条件仅涉及分组字段（如部门ID），优先用 `WHERE` 而非 `HAVING`。

- **`HAVING` 的潜在开销**
    - **需处理完整数据集**：先分组再过滤，可能增加计算资源消耗。

---

### **4. 实际应用场景**
- **组合使用 `WHERE` 和 `HAVING`**
    - **示例**：筛选 2023 年之后销售且总销量大于 10 的产品：
      ```sql
      SELECT product, SUM(quantity) 
      FROM sales 
      WHERE sale_date > '2023-01-01' 
      GROUP BY product 
      HAVING SUM(quantity) > 10;
      ```
    - **逻辑分解**：
        1. `WHERE` 先过滤时间范围内的销售记录。
        2. `GROUP BY` 对剩余数据按产品分组。
        3. `HAVING` 筛选符合条件的聚合结果。

---

### **5. 其他注意事项**
- **`HAVING` 的字段限制**
    - 只能引用 `SELECT` 中的列或聚合函数，不可直接使用未分组的字段。
    - **错误示例**：`HAVING salary > 10000`（若 `salary` 未分组或聚合）。

- **与 `JOIN` 的交互**
    - `ON` 条件用于连接表时过滤行（类似 `WHERE`），而 `WHERE` 在连接后进一步筛选。

---

### **总结**
| **对比维度**       | **`WHERE`**                     | **`HAVING`**                     |
|--------------------|----------------------------------|----------------------------------|
| **执行时机**       | 分组前                          | 分组后                          |
| **作用对象**       | 单行数据                        | 聚合结果                        |
| **聚合函数支持**   | 不支持                          | 支持                            |
| **性能影响**       | 更高效（减少数据量）            | 较低效（需处理完整数据）        |
| **典型场景**       | 精确过滤原始数据（如日期、ID）  | 筛选分组结果（如总销量、平均值）|

通过合理选择 `WHERE` 和 `HAVING`，可以显著优化查询性能并实现复杂的数据筛选需求。